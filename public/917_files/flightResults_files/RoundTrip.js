this.pageName="RoundtripList";var ListResultClient=Elong.Page.ListResultClient=Class.create();Object.extend(ListResultClient.prototype,{name:"ListResultClient",initialize:function(){this.initializeDOM();this.initializeServerData();this.initializeEvent();$("#DIVWaiting").hide();this.render();this.delayTime4Select=null;},initializeDOM:function(){this.divSearch=$("#goback");this.DataList=$("#DataList");this.calendar=$("#calendar");this.ContentEnd=$("#m_contentend");this.BackSpan=this.divSearch.find("#backSpan");this.BackDate=this.divSearch.find("#BackDate");this.day30=this.divSearch.find("a[method='30calendar']");this.DateStyle=(RoundTripController.Language.toLowerCase()=="cn"?"date":"dateEn");var a=validator.convertDate(RoundTripController.ServerTime);this.NowDate=validator.reFormatDateString(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate());this.NextDate=validator.reFormatDateString((a.getFullYear()+1)+"-"+(a.getMonth()+1)+"-"+a.getDate());this.SelectAirCorp=this.DataList.find("select[method='aircorp']");this.SelectDepartTime=this.DataList.find("select[method='departTime']");this.SelectClass=this.DataList.find("select[method='classFilter']");this.ComposeList=$("#composeBox");this.ComposeDetail=$("div[class='saleTableList']");this.composeSpan=$("#composeSpan");this.PlanTypes={};this.btnBooking=$("#btnBooking");this.SearchBox=$("div.searchbar");this.MySelects=$(".droplist");this.Itmes=$(".droplist ul");this.FlightType=this.SearchBox.find("input[name='FlightType']");this.ClassCache={};this.selectUsingObj="";this.tabItemList=$("ul.sale_tab li[method='changeTab']");this.composeFilterBox=$("#composeFilterBox");this.composeFilter=this.composeFilterBox.find("select[method = 'filter']");},initializeServerData:function(){this.resource=RoundTripController.Resources;this.FlightOneWayListDay=new Template(RoundTripController.UrlConfig.Flight_Result_OneWayseoyday.replace(/{/g,"#{"));this.FlightOneWayListBusinessDay=new Template(RoundTripController.UrlConfig.Flight_Result_OneWayseomday.replace(/{/g,"#{"));this.Flight_Result_GoRoundDay=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseoyday.replace(/{/g,"#{"));this.Flight_Result_GoRoundBusinessDay=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseomday.replace(/{/g,"#{"));this.Flight_Index=new Template(RoundTripController.UrlConfig.Flight_Index.replace(/{/g,"#{"));},initializeEvent:function(){this.DataList.bind("click",this.DataListOnClick.bindAsEventListener(this));this.DataList.bind("mouseover",this.DataListOnMouseOver.bindAsEventListener(this));this.DataList.bind("mouseout",this.DataListOnMouseOut.bindAsEventListener(this));this.btnBooking.bind("click",this.DataListOnClick.bindAsEventListener(this));this.divSearch.bind("click",this.DivSearchClick.bindAsEventListener(this));this.FlightType.bind("change",this.FlightTypeOnChange.bindAsEventListener(this));this.SelectAirCorp.bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));this.SelectDepartTime.bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));this.SelectClass.bind("change",this.SelectClassOnChange.bindAsEventListener(this));this.ComposeList.bind("mouseover",this.ComposeDataListOnMouseOver.bindAsEventListener(this));this.ComposeList.bind("mouseout",this.ComposeDataListOnMouseOut.bindAsEventListener(this));this.ComposeList.bind("click",this.ComposeDataListOnClick.bindAsEventListener(this));this.MySelects.bind("click",this.MySelectClick.bindAsEventListener(this));this.MySelects.bind("mouseover",this.MySelectMouseOver.bindAsEventListener(this));this.MySelects.bind("mouseout",this.MySelectMouseOut.bindAsEventListener(this));this.Itmes.bind("click",this.ItemsClick.bindAsEventListener(this));$(".droplist :text").click(function(){isClickSelectTextObj=1;});this.tabItemList.bind("click",this.changeTab.bindAsEventListener(this));this.composeFilter.bind("change",this.onFilterByTimeChange.bindAsEventListener(this));$(window).unload(this.dispose.bind(this));},ComposeDataListOnClick:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"btnBooking":var flightnum=element.attr("flightno1");var flightclassnum=element.attr("flightclass1");var flightnum2=element.attr("flightno2");var flightclassnum2=element.attr("flightclass2");var channel=element.attr("channel1");var channe2=element.attr("channel2");var fareid1=element.attr("fareid1");var fareid2=element.attr("fareid2");var passenger1=element.attr("passenger1");var passenger2=element.attr("passenger2");var promotionid1=element.attr("promotionid1");var promotionid2=element.attr("promotionid2");var price1=element.attr("price1");var price2=element.attr("price2");var ispackage=element.attr("ispackage");if(passenger1!=passenger2){$error(element,RoundTripController.Resources.SubmitOrderError);return;}if(!!!element.attr("disabled")){$("#bookLoading").remove();element.after('<span id="bookLoading" class="s2_loading"></span>');}if(ispackage=="1"){this.BookingOrder2(flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channe2,fareid1,fareid2,element);}else{this.BookingOrder(flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channe2,fareid1,fareid2,promotionid1,promotionid2,price1,price2,element);}break;case"planetype":case"BindInsurance":case"promotelist":case"dragon":case"flightrule":case"onehour":case"presale":case"kseat":case"web":case"Channel_MU":case"BindInsuranceWithPackage":break;case"closeOpen":var elementI=this.composeSpan.find("i");if(elementI.attr("class")=="up"){this.ComposeDetail.slideUp("slow");elementI.removeClass("up");$("#foldBtn").hide();}else{this.ComposeDetail.slideDown("slow");elementI.addClass("up");$("#foldBtn").show();}break;case"gohome":var url=this.Flight_Index.eval({language:RoundTripController.Language.toLowerCase()});location.href=url;break;default:break;}},PlanTypeOnClick:function(b){var d=b.attr("planetype");var a=b.attr("aircorp");var c=RoundTripController.Language.toLowerCase();if(this.PlanTypes[c+"_"+a+"_"+d]){if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:b,width:379,defer:false,htmlContent:this.PlanTypes[c+"_"+a+"_"+d]});}else{FlightAjaxController.GetPlaneType(d,a,function(g){if(g.success){var f='<ul><li><b>{0}</b></li><li>{1}</li><li style="display:{3}"><img  src="{2}" width="310" height="240"  alt="" /></li></ul>';var e=g.value!=null?String.format(f,g.value.Name,g.value.Tip,g.value.PlaneImage,"block"):String.format(f,FlightAjaxController.Resources.PlanType_NoPlan,"","#","none");if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:b,width:379,defer:false,htmlContent:e});this.PlanTypes[c+"_"+a+"_"+d]=e;}}.bind(this),true);}},showFlightFee:function(a){if(this.listWindow!=null){this.listWindow.close();}var a=Event.element(a);var b=a.attr("feetip")||"";this.listWindow=new TipWindow({eventElement:a,defer:false,width:240,buildHtmlContent:function(c){c.htmlContent=b;c.show();}.bind(this)});},FlightRestriction:function(a){if(this.listWindow!=null){this.listWindow.close();}var a=Event.element(a);var e=a.attr("rule");var d=a.attr("journey");var f=a.parents("table");var b=f.find("input[method='btnBooking']");var c=b.attr("ispackage");this.listWindow=new TipWindow({eventElement:a,defer:false,width:240,buildHtmlContent:function(h){var g=a.next().html();if(g.trim()!=""){h.htmlContent="<div >"+g+"</div>";h.show();}else{RoundTripController.RestrictionRule(RoundTripController.SearchRequest,e,a.attr("index"),d,c,function(i){if(i.success){if(this.listWindow!=null){this.listWindow.close();}h.htmlContent="<div >"+i.value+"</div>";h.show();a.next().html(i.value);}}.bind(this),true);}}.bind(this)});},MySelectClick:function(b){var a=Event.element(b);var e=a.attr("idtag");this.MySelects.removeClass("droplist_on");if(this.selectCloseUsing==1){return;}var g=(e==undefined?a.parents(".droplist"):a);if(this.selectUsingObj!=""&&this.selectUsingObj!=g.attr("idtag")){g.removeClass("droplist_on");}if(this.selectUsingObj!=""){clearTimeout(this.delayTime4Select);this.selectCloseUsing=1;g.removeClass("droplist_on");this.selectUsingObj="";this.delayTime4Select=setTimeout(function(){this.selectCloseUsing=0;this.isClickSelectTextObj=0;}.bind(this),200);}else{this.selectUsingObj=g.attr("idtag");clearTimeout(this.delayTime4Select);var e=g.attr("idtag");var d="";var c=$("#"+e);if(c.length>0){d=$("#"+e).val();}var f=g.find("ul.box");g.addClass("droplist_on");}},MySelectMouseOver:function(a){this.selectCloseUsing=0;},MySelectMouseOut:function(b){var a=Event.element(b);this.selectCloseUsing=1;this.delayTime4Select=setTimeout(function(){if(this.selectCloseUsing==1&&this.isClickSelectTextObj==0){$("div.droplist").removeClass("droplist_on");this.isItemHover=0;this.selectUsingObj="";}}.bind(this),3000);},setCity:function(objId,citycode,citynamecn,citynameen){if(RoundTripController.Language.toLowerCase()=="cn"){$("#"+objId).val(citynamecn);$("#"+objId).attr("cityname",citynameen);}else{$("#"+objId).val(citynameen);$("#"+objId).attr("cityname",citynamecn);}if(citynameen!=null&&citynameen!="undefined"&&citynameen!=""){$("#"+objId).attr("citynameen",citynameen);}$("#"+objId).attr("citythreesign",citycode);eval(String.format('var city = {CityThreeSign:"{0}",CityNameCn:"{1}",CityNameEn:"{2}"}',citycode,citynamecn,citynameen));$("#"+objId).get(0).City=city;},getCity:function(obj){if(obj==null||obj=="undefined"||obj.get(0).City==null||obj.get(0).City=="undefined"){eval(String.format('var city = {CityThreeSign:"{0}",CityNameCn:"{1}",CityNameEn:"{2}"}',"","",""));return city;}if(obj.get(0).City.CityNameEn==undefined&&String.isNullOrEmpty(obj.get(0).City.CityNameEn&&obj.attr("citynameen")!=undefined)){obj.get(0).City.CityNameEn=obj.attr("citynameen");}return obj.get(0).City;},FlightTypeOnChange:function(){switch(this.FlightType.val()){case"0":this.BackSpan.hide();this.BackDate.hide();break;case"1":this.BackDate.show();this.BackSpan.show();break;case"2":break;default:break;}},DivSearchClick:function(d){var c=Event.element(d);var e=c.attr("method");switch(e){case"Date":new CalendarWindow({language:RoundTripController.Language,eventElement:c,enabledFrom:this.NowDate,enabledTo:this.NextDate,selectedDate:String.isNullOrEmpty(c.val())?this.NowDate:c.val(),onSelected:function(m){c.val(m);if(c.attr("name")=="DepartDate"&&this.divSearch.find("select[name='FlightType']").val()==1){var o=validator.reFormatDateString(m);var n=validator.convertDate(o);var k=validator.reFormatDateString(this.divSearch.find("input[name='BackDate']").val());if(o>k){var l=new Date(n.setDate(n.getDate()+3));var j=validator.reFormatDateString(l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate());if(RoundTripController.Language=="EN"){j=validator.reFormatDateStringEn(j);}this.divSearch.find("input[name='BackDate']").val(j);}this.divSearch.find("input[name='BackDate']").click();}}.bind(this)});break;case"search":case"searchAgain":this.btnSearchClick(d);break;case"30calendar":case"30calendarArrow":this.ShowlowestPriceCalendarOnClick(d);break;case"30calendarHide":this.day30.children("span").attr("class","down");this.day30.attr("class","date-but");this.calendar.slideUp("slow");$("i[method='30calendarArrow']").attr("class","down");$("i[method='30calendarArrow']").attr("tag","down");case"reset":var f=this.calendar.find("input[type='radio']");f.attr("checked",false);f.attr("disabled",false);f.parent().next().find("a").removeClass("dis").attr("method","getOWLowestPriceOneDay");f.parents("td").removeClass("on");$("#LowestPriceStartDate").val("");$("#LowestPriceEndDate").val("");break;case"changecity":var a=this.divSearch.find("#Round_DepartCity");var b=this.divSearch.find("#Round_ArriveCity");var g=a.val();var h=a.attr("citythreesign");var i=a.attr("citynameen");this.setCity("Round_DepartCity",b.attr("citythreesign"),RoundTripController.Language=="CN"?b.val():"",RoundTripController.Language=="EN"?b.val():b.attr("citynameen"));this.setCity("Round_ArriveCity",h,RoundTripController.Language=="CN"?g:"",RoundTripController.Language=="EN"?g:i);break;default:break;}},getDateOffset:function(c,d){var a=validator.convertDateTime(c);var b=validator.convertDateTime(d);return Math.round(Math.abs((b.getTime()-a.getTime())/86400000));},filterCityNameEn:function(a){var b=a.replace(/[^\d\w]/g,"_").toLowerCase();while(b.indexOf("__")!=-1){b=b.replace("__","_");}return b;},btnSearchClick:function(evt){if(this.wind!=null){this.wind.close();}var wind=new Dialog({title:"",htmlContent:$("#DIVWaiting").html(),width:RoundTripController.Language.toLowerCase()=="cn"?320:400,height:100,initEvent:function(windowElement){var waiting=windowElement.find("div[method='SearchWaiting']");waiting.show();}.bind(this)});wind.show();var url;var element=Event.element(evt);var departCityObj=this.getCity($("#Round_DepartCity"));var arriveCityObj=this.getCity($("#Round_ArriveCity"));var StartDate;var EndDate;if(element.attr("method")=="searchAgain"){if(departCityObj.CityNameEn.toLowerCase()==arriveCityObj.CityNameEn.toLowerCase()){$error($("#Round_ArriveCity"),RoundTripController.Resources.Validate_SameCity);wind.close();return false;}StartDate=$("input[name='DepartDate']").val();EndDate=$("input[name='BackDate']").val();var dateStart=validator.reFormatDateString(StartDate);var dateEnd=validator.reFormatDateString(EndDate);if(this.FlightType.val()==1){if(dateEnd<this.NowDate){$error($("input[name='BackDate']"),RoundTripController.Resources.Validate_BeforeToday);wind.close();return false;}if(dateEnd>this.NextDate){$error($("input[name='BackDate']"),RoundTripController.Resources.Validate_LimitDate);wind.close();return false;}if(dateStart>dateEnd){$error($("input[name='BackDate']"),RoundTripController.Resources.Validate_DateCheck);wind.close();return false;}}}else{if(element.attr("method")=="search"){StartDate=$("#LowestPriceStartDate").val();EndDate=$("#LowestPriceEndDate").val();if(StartDate==""){$error($(element),RoundTripController.Resources.Validate_NoDateSelected);wind.close();return false;}if(EndDate==""){$error($(element),RoundTripController.Resources.Validate_NoDateSelected);wind.close();return false;}var dayCount1=this.getDateOffset(this.NowDate,validator.reFormatDateString(StartDate));var dayCount2=this.getDateOffset(this.NowDate,validator.reFormatDateString(EndDate));var urlTeml="";urlTeml=this.Flight_Result_GoRoundDay;url=urlTeml.eval({departcitynameen:this.filterCityNameEn(departCityObj.CityNameEn),arrivecitynameen:this.filterCityNameEn(arriveCityObj.CityNameEn),language:RoundTripController.Language.toLowerCase(),daycount:dayCount1,backdaycount:dayCount2});ConditionValue={FType:1,DepCode:departCityObj.CityThreeSign,ArrCode:arriveCityObj.CityThreeSign,DepDate:validator.reFormatDateString(StartDate),DepName:encodeURIComponent($("#Round_DepartCity").val())+"|"+departCityObj.CityNameEn,ArrName:encodeURIComponent($("#Round_ArriveCity").val())+"|"+arriveCityObj.CityNameEn,BackDate:EndDate};}}if(this.FlightType.val()==0){var urlTeml="";urlTeml=this.FlightOneWayListDay;var dayCount=this.getDateOffset(this.NowDate,validator.reFormatDateString($("input[name='DepartDate']").val()));url=urlTeml.eval({departcitynameen:this.filterCityNameEn(departCityObj.CityNameEn),arrivecitynameen:this.filterCityNameEn(arriveCityObj.CityNameEn),language:RoundTripController.Language.toLowerCase(),daycount:dayCount});ConditionValue={FType:0,DepCode:departCityObj.CityThreeSign,ArrCode:arriveCityObj.CityThreeSign,DepDate:validator.reFormatDateString(StartDate),DepName:encodeURIComponent($("#Round_DepartCity").val())+"|"+departCityObj.CityNameEn,ArrName:encodeURIComponent($("#Round_ArriveCity").val())+"|"+arriveCityObj.CityNameEn};}else{if(this.FlightType.val()==1&&element.attr("method")!="search"){var dayCount1=this.getDateOffset(this.NowDate,validator.reFormatDateString($("input[name='DepartDate']").val()));var dayCount2=this.getDateOffset(this.NowDate,validator.reFormatDateString($("input[name='BackDate']").val()));var urlTeml="";urlTeml=this.Flight_Result_GoRoundDay;url=urlTeml.eval({departcitynameen:this.filterCityNameEn(departCityObj.CityNameEn),arrivecitynameen:this.filterCityNameEn(arriveCityObj.CityNameEn),language:RoundTripController.Language.toLowerCase(),daycount:dayCount1,backdaycount:dayCount2});ConditionValue={FType:1,DepCode:departCityObj.CityThreeSign,ArrCode:arriveCityObj.CityThreeSign,DepDate:validator.reFormatDateString(StartDate),DepName:encodeURIComponent($("#Round_DepartCity").val())+"|"+departCityObj.CityNameEn,ArrName:encodeURIComponent($("#Round_ArriveCity").val())+"|"+arriveCityObj.CityNameEn,BackDate:EndDate};}}if(!Object.isNull(ConditionValue)){Globals.cookie("FlightCondition","",ConditionValue,{expires:30,path:"/",secure:false});}if(window.location.host=="big5.elong.com"){var ht="ht";url=ht+"tp://big5.elong.com/gate/big5/flight.elong.com"+url;}window.location.href=url;element.addClass("searchbtn_disable");element[0].disabled=true;return true;},DataListOnClick:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"btnBooking":var flightnum=element.attr("flightno1");var flightclassnum=element.attr("flightclass1");var flightnum2=element.attr("flightno2");var flightclassnum2=element.attr("flightclass2");var channel=element.attr("channel1");var channe2=element.attr("channel2");var fareid1=element.attr("fareid1");var fareid2=element.attr("fareid2");var passenger1=element.attr("passenger1");var passenger2=element.attr("passenger2");var promotionid1=element.attr("promotionid1");var promotionid2=element.attr("promotionid2");var price1=element.attr("price1");var price2=element.attr("price2");if(passenger1!=passenger2){$error(element,RoundTripController.Resources.SubmitOrderError);return;}$("#bookLoading").remove();element.after('<span id="bookLoading" class="s2_loading"></span>');this.BookingOrder(flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channe2,fareid1,fareid2,promotionid1,promotionid2,price1,price2,element);break;case"spanMore":element.prev("span[method='moreflight']").click();break;case"moreflight":this.MoreFlight(element);break;case"youthsenior":element.parents("table:eq(0)").find("span[method='moreflight']:eq(0)").click();break;case"select":var list=element.attr("name").split("_")[1];var itemids=element.attr("itemid").split("_");var itemid=itemids[0];var flightNo=element.attr("flightno");var flightclass=element.attr("flightclass");var fareid=element.attr("fareid");var price=element.attr("price");var passenger=element.attr("passenger");var cachekey=$("#filterarea"+list).find("input[id='cachekey']").val();var channel=element.attr("channel");var promotionid=element.attr("promotionid");this.DataList.find(".tishi").hide();this.btnBooking.attr("listid");if(this.btnBooking.attr("list1open")=="1"&&this.btnBooking.attr("list2open")=="1"){this.btnBooking.attr("listid","");}if(list=="1"){this.btnBooking.attr("list1open","0");}else{this.btnBooking.attr("list2open","0");}if(list=="1"&&(this.btnBooking.attr("listid")=="1"||this.btnBooking.attr("listid")=="")){var datalist=$("#datalist1");$("img[method='imgWait"+list+"']").attr("src",$("input[type='hidden'][method='hdnWait']").val());datalist.hide();$("#imgWait"+list).show();$("#choosed2").val("");RoundTripController.GetSecondListAjax(RoundTripController.SearchRequest,flightNo,flightclass,cachekey,promotionid,channel,price,function(ret){if(ret.value.indexOf("empty")>=0||ret.value=='<?xml version="1.0"?>'){datalist.show();var msg=datalist.find("p[method='NoResult']");if(element.attr("channel")=="MU"){datalist.find("p[method='MUNoResult']").show();}else{msg.show();}msg.next().show();$("#filterarea2").hide();$("div[method='DataRow2']").hide();datalist.find("span[method='flightcount']").text("0");var msg=this.DataList.find("p[method='msg'][list=2]");msg.hide();msg.next().hide();}else{datalist.html(ret.value);datalist.show();datalist.find("select[method='departTime']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));datalist.find("select[method='aircorp']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));datalist.find("select[method='classFilter']").bind("change",this.SelectClassOnChange.bindAsEventListener(this));}$("#imgWait"+list).hide();}.bind(this),false,"POST");}else{if(list=="2"&&(this.btnBooking.attr("listid")=="2"||this.btnBooking.attr("listid")=="")){$("img[method='imgWait"+list+"']").attr("src",$("input[type='hidden'][method='hdnWait']").val());var datalist=$("#datalist2");datalist.hide();$("#imgWait"+list).show();$("#choosed1").val("");RoundTripController.GetFirstListAjax(RoundTripController.SearchRequest,flightNo,flightclass,cachekey,promotionid,channel,price,function(ret){if(ret.value.indexOf("empty")>=0||ret.value=='<?xml version="1.0"?>'){datalist.show();var msg=$("#datalist"+list).find("p[method='NoResult']");if(element.attr("channel")=="MU"){datalist.find("p[method='MUNoResult']").show();}else{msg.show();}msg.next().show();$("#filterarea1").hide();$("div[method='DataRow1']").hide();datalist.find("span[method='flightcount']").text("0");var msg=this.DataList.find("p[method='msg'][list=1]");msg.hide();msg.next().hide();}else{datalist.html(ret.value);datalist.show();datalist.find("select[method='departTime']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));datalist.find("select[method='aircorp']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));datalist.find("select[method='classFilter']").bind("change",this.SelectClassOnChange.bindAsEventListener(this));}this.DataList.find(".tishi").hide();$("#imgWait"+list).hide();}.bind(this),false,"POST");}}this.DataList.find("div[method='DataRow"+list+"'][itemid!='"+itemid+"']").each(function(){$(this).slideUp("slow");});this.btnBooking.attr("flightno"+list,flightNo);this.btnBooking.attr("flightclass"+list,flightclass);this.btnBooking.attr("channel"+list,channel);this.btnBooking.attr("fareid"+list,fareid);this.btnBooking.attr("price"+list,price);this.btnBooking.attr("passenger"+list,passenger);this.btnBooking.attr("promotionid"+list,promotionid);if(this.btnBooking.attr("listid")==""){this.btnBooking.attr("listid",list);}$("#choosed"+list).val(element.attr("price"));if($("#choosed1").val()!=""&&$("#choosed2").val()!=""){this.DataList.find("p[method='msg']").each(function(){$(this).show();$(this).next().hide();});$("#totalprice").text(new Number($("#choosed1").val())+new Number($("#choosed2").val()));$("#placeOrder").show();}else{$("#placeOrder").hide();var msg=this.DataList.find("p[method='msg'][list='"+list+"']");msg.show();msg.next().show();}if(element.attr("channel")=="MU"){$("#msgMU"+list).show();}else{$("#msgMU"+list).hide();}if((this.btnBooking.attr("channel1")=="MU"||this.btnBooking.attr("channel2")=="MU")&&this.btnBooking.attr("channel1")!=this.btnBooking.attr("channel2")){$("#placeOrder").hide();}if((this.btnBooking.attr("channel1")=="MU"||this.btnBooking.attr("channel2")=="MU")&&this.btnBooking.attr("channel1")==this.btnBooking.attr("channel2")){$("#msgMU1").hide();$("#msgMU2").hide();}break;case"view":var list=element.attr("list");if(list==1){element.parents("div[class='go-box']").find("input[method='select']").each(function(){$(this).attr("checked",false);});this.btnBooking.attr("list1open","1");this.btnBooking.attr("listid","2");$("#placeOrder").hide();}else{element.parents("div[class='back-box']").find("input[method='select']").each(function(){$(this).attr("checked",false);});this.btnBooking.attr("list2open","1");this.btnBooking.attr("listid","1");$("#placeOrder").hide();}$("select[method='sort']").eq(list-1).val("Price");$("select[method='aircorp']").eq(list-1).val("");$("select[method='departTime']").eq(list-1).val("");$("select[method='sort']").eq(list-1).change();this.DataList.find("div[method='DataRow"+list+"']").each(function(){$(this).slideDown("slow");});element.parent("p").next().hide();element.parent("p").hide();$("#msgMU"+list).hide();if(list=="1"){if($("#choosed1").val()==""){if($("#choosed2").val()!=""){$("#datalist"+list).find("p[method='msg']").next().show();}}}else{if($("#choosed2").val()==""){if($("#choosed1").val()!=""){$("#datalist"+list).find("p[method='msg']").next().show();}}}FunctionExt.defer(function(){$("span[method='flightcount']").eq(list-1).html(this.DataList.find("div[method='DataRow"+list+"']:visible").length);},1000,this);break;case"gohome":var url=this.Flight_Index.eval({language:RoundTripController.Language.toLowerCase()});location.href=url;break;case"":break;case"td":var parentTr=element.parent();var span=$(parentTr).find("span[method='moreflight']:first");span.click();break;case"tdMore":var parentLi1=element.parents("div[method='DataRow1']:first");var parentLi2=element.parents("div[method='DataRow2']:first");var parentLi;if(parentLi1.text()!=""){parentLi=parentLi1;}if(parentLi2.text()!=""){parentLi=parentLi2;}var span=$(parentLi).find("span[method='moreflight']:first");span.click();break;case"sortTP":this.SelectAirCorpOnChangeNew(evt);default:break;}},MoreFlight_ShowFlight:function(c,d,b){var a=$("div[method='DataRow"+d+"'][itemid='"+c+"']");var e=a.find("tr[method='recommand']");var f=a.find("p[method='young']");if(b){a.find("span[method='spanMore']").attr("class","flight_down flight_up");a.addClass("tablebg"+(d=="2"?"2":""));e.hide();f.hide();a.find("div[method='divMore']").slideDown("slow");}else{a.find("span[method='spanMore']").attr("class","flight_down");if(!a.find("input[type='radio']").attr("checked")){}a.find("div[method='divMore']").slideUp("slow",function(){e.show();f.show();});}},HideMoreFlight:function(a){$("div[method='DataRow"+a+"'] div[method='divMore']").each(function(c){var b=$(this).parent("div");b.find("span[method='spanMore']").attr("class","flight_down");b.find("div[method='divMore']").hide();b.find("tr[method='recommand']").show();b.find("p[method='young']").show();});},MoreFlight:function(d){var h=d.attr("itemid");var g=d.attr("flightNo");var f=d.attr("flightclass");var c=d.attr("datacache");var e=d.attr("fareid");var b=d.attr("channel");var k=d.attr("uniqueKey");var j=d.attr("price");var i=d.attr("list");var a=$("#filterarea"+i).find("input[id='cachekey']").val();if($("div[method='DataRow"+i+"'][itemid='"+h+"']").find("span[method='spanMore']").attr("class")=="flight_down"){if(c=="1"){this.HideMoreFlight(i);this.MoreFlight_ShowFlight(h,i,true);}else{d.parents("tr").find("td[class='cols3']").find("span[method='loadding']").addClass("s_loading").show();d.hide();d.next("span[method='spanMore']").hide();if(i=="1"){RoundTripController.GetFirstMoreFlight(RoundTripController.SearchRequest,g,f,this.btnBooking.attr("flightno2"),this.btnBooking.attr("flightclass2"),a,h,e,this.btnBooking.attr("promotionid2"),b,this.btnBooking.attr("channel2"),k,this.btnBooking.attr("price2"),function(m){this.HideMoreFlight(i);$("div[method='DataRow"+i+"'][itemid='"+h+"'] div[method='divMore']").html(m.value);var l=$("div[method='DataRow"+i+"'] input[type='radio'][itemid='"+h+"']").attr("disabled");$("div[method='DataRow"+i+"'][itemid='"+h+"'] div[method='divMore']").find("input[type='radio'][itemid^='"+h+"']").each(function(){$(this).attr("disabled",l);});this.MoreFlight_ShowFlight(h,i,true);d.attr("datacache","1");d.prev("span[method='loadding']").addClass("").hide();d.show();d.next("span[method='spanMore']").show();}.bind(this),false,"POST");}else{RoundTripController.GetSecondMoreFlight(RoundTripController.SearchRequest,g,f,this.btnBooking.attr("flightno1"),this.btnBooking.attr("flightclass1"),a,h,e,this.btnBooking.attr("promotionid1"),b,this.btnBooking.attr("channel1"),k,this.btnBooking.attr("price1"),function(m){this.HideMoreFlight(i);$("div[method='DataRow"+i+"'][itemid='"+h+"'] div[method='divMore']").html(m.value);var l=$("div[method='DataRow"+i+"'] input[type='radio'][itemid='"+h+"']").attr("disabled");$("div[method='DataRow"+i+"'][itemid='"+h+"'] div[method='divMore']").find("input[type='radio'][itemid^='"+h+"']").each(function(){$(this).attr("disabled",l);});this.MoreFlight_ShowFlight(h,i,true);d.attr("datacache","1");d.prev("span[method='loadding']").addClass("").hide();d.show();d.next("span[method='spanMore']").show();}.bind(this),false,"POST");}}}else{this.MoreFlight_ShowFlight(h,i,false);}},BookingOrder:function(flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channel2,fareid1,fareid2,promotionid1,promotionid2,price1,price2,evt){RoundTripController.BookingOrder(RoundTripController.SearchRequest,flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channel2,fareid1,fareid2,promotionid1,promotionid2,price1,price2,function(ret){if(ret.success){var nexturl="";var url=new Template(RoundTripController.UrlConfig.Flight_FillOrder.replace(/{/g,"#{"));var orderurl=url.eval({language:RoundTripController.Language.toLowerCase(),cachekey:ret.value});nexturl=orderurl;if(window.location.host=="big5.elong.com"){var ht="ht";nexturl=ht+"tp://flight.elong.com"+nexturl;}window.location=nexturl+"?tabIndex="+$("#tabIndex").val();}else{$("#bookLoading").remove();$("input[method='btnBooking']").removeClass("bt_ord com_book_dis").attr("disabled",false);if(ret.value=="PaymentTypeConflict"){var wind=new Dialog({title:"",htmlContent:'<div class="sel_error_box"><p>'+RoundTripController.Resources.Validate_PaymentType+'</p><a href="#?" class="search_btn2" id="btnRefresh">'+RoundTripController.Resources.Validate_PaymentType_OK+"</a></div>",width:476,height:245,initEvent:function(windowElement){var btnRefresh=windowElement.find("#btnRefresh");btnRefresh.bind("click",function(){wind.close();});}.bind(this)});wind.show();}if(ret.value=="date"){var wind=new Dialog({title:RoundTripController.Resources.Validate_Title,htmlContent:'<div id="classbox" align="center"><p class="content">'+RoundTripController.Resources.Validate_WrongDate+'</p><p class="searchbtn"><input type="button" id="btnRefresh" class="search_bt_s"  onmousedown="this.className=\'search_bt_s_an\'" onmouseup="this.className=\'search_bt_s\'"   onmouseout="this.className=\'search_bt_s\'" onfocus="this.blur()" value="'+RoundTripController.Resources.Filter_OK+'" /></p></div>',width:380,height:120,initEvent:function(windowElement){var btnRefresh=windowElement.find("#btnRefresh");btnRefresh.bind("click",function(){wind.close();});}.bind(this)});wind.show();}if(ret.value.indexOf("empty")>=0){var wind=new Dialog({title:RoundTripController.Resources.Empty_Title,htmlContent:'<div class="payment_tip"><br /><p style="line-height:24px;color:#ff8800" class="tc mb10">'+RoundTripController.Resources.Empty_Content+'</p><div class="mt20 tc"><a href="#?" id="btnRefresh" class="search_btn3" style="color:#fff;">'+RoundTripController.Resources.SearchAgain+"</a><br/></div></div>",width:380,height:150,initEvent:function(windowElement){var btnRefresh=windowElement.find("#btnRefresh");btnRefresh.bind("click",function(){var flag=ret.value.split(";");var emptyurl=window.location.href.replace("#","");if(flag.length==2&&flag[1]!=""){if(RoundTripController.SearchRequest.FlightType.toLowerCase()=="roundtrip"){var urlTeml="";if(RoundTripController.SearchRequest.SeatLevel.toLowerCase()=="y"){urlTeml=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseoyday.replace(/{/g,"#{"));}else{urlTeml=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseomday.replace(/{/g,"#{"));}var dayCount1=RoundTripController.SearchRequest.DayCount;var dayCount2=RoundTripController.SearchRequest.BackDayCount;var url=urlTeml.eval({language:RoundTripController.Language.toLowerCase(),departcitynameen:RoundTripController.SearchRequest.DepartCityNameEn.toLowerCase().replace(/\'/g,""),arrivecitynameen:RoundTripController.SearchRequest.ArriveCityNameEn.toLowerCase().replace(/\'/g,""),daycount:dayCount1,backdaycount:dayCount2});emptyurl=url;}}else{emptyurl=window.location.href.replace("#","");}if(emptyurl.indexOf("refresh=1")<0){if(emptyurl.indexOf("?")>0){emptyurl=emptyurl+"&refresh=1";}else{emptyurl=emptyurl+"?refresh=1";}}window.location.href=emptyurl;wind.close();});}.bind(this)});wind.show();}this.btnBooking.removeClass("bt_ord com_book_dis").addClass("bt_ord").removeAttr("disabled");}evt.prev().find("span[method='loadding']").addClass("").hide();evt.show();}.bind(this),false,"POST",false);},BookingOrder2:function(flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channel2,fareid1,fareid2,evt){var price=evt.attr("price1");var aircorp1=evt.attr("aircorp1");var aircorp2=evt.attr("aircorp2");RoundTripController.BookingOrder2(RoundTripController.SearchRequest,flightnum,flightclassnum,channel,flightnum2,flightclassnum2,channel2,fareid1,fareid2,price,aircorp1,aircorp2,function(ret){if(ret.success){var nexturl="";var url=new Template(RoundTripController.UrlConfig.Flight_FillOrder.replace(/{/g,"#{"));var orderurl=url.eval({language:RoundTripController.Language.toLowerCase(),cachekey:ret.value});nexturl=orderurl;if(window.location.host=="big5.elong.com"){var ht="ht";nexturl=ht+"tp://flight.elong.com"+nexturl;}window.location=nexturl+"?tabIndex="+$("#tabIndex").val();}else{$("#bookLoading").remove();$("input[method='btnBooking']").removeClass("bt_ord com_book_dis").attr("disabled",false);if(ret.value.indexOf("empty")>=0){var wind=new Dialog({title:RoundTripController.Resources.Empty_Title,htmlContent:'<div class="payment_tip"><br /><p style="line-height:24px;color:#ff8800" class="tc mb10">'+RoundTripController.Resources.Empty_Content+'</p><div class="mt20 tc"><a href="#?" id="btnRefresh" class="search_btn3" style="color:#fff;">'+RoundTripController.Resources.SearchAgain+"</a><br/></div></div>",width:380,height:150,initEvent:function(windowElement){var btnRefresh=windowElement.find("#btnRefresh");btnRefresh.bind("click",function(){var flag=ret.value.split(";");var emptyurl=window.location.href.replace("#","");if(flag.length==2&&flag[1]!=""){if(RoundTripController.SearchRequest.FlightType.toLowerCase()=="roundtrip"){var urlTeml="";if(RoundTripController.SearchRequest.SeatLevel.toLowerCase()=="y"){urlTeml=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseoyday.replace(/{/g,"#{"));}else{urlTeml=new Template(RoundTripController.UrlConfig.Flight_Result_GoRoundseomday.replace(/{/g,"#{"));}var dayCount1=RoundTripController.SearchRequest.DayCount;var dayCount2=RoundTripController.SearchRequest.BackDayCount;var url=urlTeml.eval({language:RoundTripController.Language.toLowerCase(),departcity:RoundTripController.SearchRequest.DepartCityNameEn.toLowerCase().replace(/\'/g,""),arrivecity:RoundTripController.SearchRequest.ArriveCityNameEn.toLowerCase().replace(/\'/g,""),daycount:dayCount1,backdaycount:dayCount2});emptyurl=url;}}else{emptyurl=window.location.href.replace("#","");}if(emptyurl.indexOf("refresh=1")<0){if(emptyurl.indexOf("?")>0){emptyurl=emptyurl+"&refresh=1";}else{emptyurl=emptyurl+"?refresh=1";}}window.location.href=emptyurl;wind.close();});}.bind(this)});wind.show();}this.btnBooking.removeClass("bt_ord com_book_dis").addClass("bt_ord").removeAttr("disabled");$("#bookLoading").remove();}evt.prev().find("span[method='loadding']").addClass("").hide();evt.show();}.bind(this),false,"POST",false);},Channel_MUMouseOver:function(b){var a=Event.element(b);if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(c){c.htmlContent=RoundTripController.Resources.Channel_MU_Description;c.show();}});},Channel_Book51MouseOver:function(b){var a=Event.element(b);if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(c){c.htmlContent=RoundTripController.Resources.Channel_Book51_Description;c.show();}});},ClassName:function(c,b,a){if(this.ClassCache[c+b]){if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({htmlContent:"<div >"+this.ClassCache[c+b]+"</div>",eventElement:a,defer:false,width:240});}else{FlightAjaxController.ClassDescription(c,b,RoundTripController.SearchRequest,a.attr("way"),function(d){if(d.success){this.ClassCache[c+b]=d.value;if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({htmlContent:"<div >"+d.value+"</div>",eventElement:a,defer:false,width:240});}}.bind(this),true);}},DataListOnMouseOver:function(d){var c=Event.element(d);var g=c.attr("method");switch(g){case"PlaneType":this.PlanTypeOnClick(c);break;case"StopOver":var f=c.attr("flightno");this.StopOver(f,c);break;case"Channel_MU":this.Channel_MUMouseOver(d);break;case"Channel_Book51":this.Channel_Book51MouseOver(d);break;case"BindInsurance":var h=c.parents("tr").find("td[class='cols5']").find("input").attr("price");if(h!=undefined){h=parseInt(h)+20;}else{var b=c.parents("tr").find("td[class='cols04']").find("input").val();h=parseInt(b)+20;}if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=String.format(RoundTripController.Resources.BindInsurance_Tip,h);j.show();}});break;case"BindInsuranceWithPackage":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=RoundTripController.Resources.PackageBindInsurance_Tip.toString();j.show();}});break;case"promotelist":this.ShowPromoteList(c);break;case"qqpromotelist":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent="QQ会员专享";j.show();}});break;case"class":var f=c.attr("flightno");var e=c.attr("flightclass");this.ClassName(f,e,c);break;case"presale":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=c.next().html();j.show();}});break;case"dragon":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=RoundTripController.Resources.DragonTip;j.show();}});break;case"youth":var a=c.attr("aircorp");var i=c.attr("passenger");if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,defer:false,width:240,buildHtmlContent:function(j){FlightAjaxController.GetYoungSeniorDetail(a,i,function(k){if(k.success){j.htmlContent="<div >"+k.value.Description+"</div>";j.show();}}.bind(this),true);}.bind(this)});break;case"flightrule":this.FlightRestriction(d);break;case"flightFee":this.showFlightFee(d);break;default:break;}},DataListOnMouseOut:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"PlaneType":case"StopOver":case"qqpromotelist":case"class":case"youth":case"flightrule":case"flightFee":this.ContentEnd.html("");break;case"promotelist":if(a.attr("isCoupon")!="1"){this.ContentEnd.html("");}break;default:break;}},ComposeDataListOnMouseOver:function(d){var c=Event.element(d);var g=c.attr("method");switch(g){case"PlaneType":this.PlanTypeOnClick(c);break;case"StopOver":var f=c.attr("flightno");this.StopOver(f,c);break;case"Channel_MU":this.Channel_MUMouseOver(d);break;case"Channel_Book51":this.Channel_Book51MouseOver(d);break;case"BindInsurance":var h=c.parents("tr").find("td[class='cols5']").find("input").attr("price");if(h!=undefined){h=parseInt(h)+20;}else{var b=c.parents("tr").find("td[class='cols04']").find("input").val();h=parseInt(b)+20;}if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=String.format(RoundTripController.Resources.BindInsurance_Tip,h);j.show();}});break;case"BindInsuranceWithPackage":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=RoundTripController.Resources.PackageBindInsurance_Tip.toString();j.show();}});break;case"promotelist":this.ShowPromoteList(c);break;case"qqpromotelist":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent="QQ会员专享";j.show();}});break;case"class":var f=c.attr("flightno");var e=c.attr("flightclass");this.ClassName(f,e,c);break;case"presale":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=c.next().html();j.show();}});break;case"dragon":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,width:240,defer:false,buildHtmlContent:function(j){j.htmlContent=RoundTripController.Resources.DragonTip;j.show();}});break;case"youth":var a=c.attr("aircorp");var i=c.attr("passenger");if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:c,defer:false,width:240,buildHtmlContent:function(j){FlightAjaxController.GetYoungSeniorDetail(a,i,function(k){if(k.success){j.htmlContent="<div >"+k.value.Description+"</div>";j.show();}}.bind(this),true);}.bind(this)});break;case"flightrule":this.FlightRestriction(d);break;case"flightFee":this.showFlightFee(d);break;default:break;}},ComposeDataListOnMouseOut:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"PlaneType":case"StopOver":case"Channel_MU":case"BindInsurance":case"BindInsuranceWithPackage":case"qqpromotelist":case"class":case"presale":case"dragon":case"youth":case"flightrule":case"flightFee":this.ContentEnd.html("");break;case"promotelist":if(a.attr("isCoupon")!="1"){this.ContentEnd.html("");}break;default:break;}},ShowPromoteList:function(a){var b=a.attr("pid");var c=a.attr("price");if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:true,buildHtmlContent:function(d){FlightAjaxController.GetPromotInfo(b,function(e){if(e.success){d.htmlContent=e.value.toString().replace("#price#",c);d.show();}}.bind(this),true);}});},SelectClassOnChange:function(d){var c=Event.element(d);var e=2;var f=1;if(c.attr("id").endsWith("1")){f=2;e=1;}var a=c.val();var b=$("#datalist"+f);$("img[method='imgWait"+f+"']").attr("src",$("input[type='hidden'][method='hdnWait']").val());b.hide();$("#imgWait"+f).show();RoundTripController.SearchRequest.SeatLevel=a;RoundTripController.Filter(RoundTripController.SearchRequest,a,e,function(g){if(g.value.indexOf("empty")>=0||g.value=='<?xml version="1.0"?>'){b.show();$("#filterarea"+f).hide();b.find("span[method='flightcount']").text("0");}else{b.html(g.value);b.show();b.find("select[method='departTime']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));b.find("select[method='aircorp']").bind("change",this.SelectAirCorpOnChange.bindAsEventListener(this));b.find("select[method='classFilter']").bind("change",this.SelectClassOnChange.bindAsEventListener(this));}this.DataList.find(".tishi").hide();$("#imgWait"+f).hide();}.bind(this),false,"POST");},SelectAirCorpOnChange:function(e){var d=Event.element(e);var f=d.attr("id");var j=d.attr("value");var g=d.attr("method");var h="price";var a="";var i=new Array();if(f.endsWith("1")){a=$("#timeFilter1").val();}else{a=$("#timeFilter2").val();}if(f.toLowerCase().startsWith("timefilter")||a!=""){i.push("flighttime");i.push("price");h="flighttime";}else{i.push("price");i.push("flighttime");h="price";}if(f.endsWith("1")){if(g=="aircorp"&&a==""){$("#sortprice1").addClass("sort_price_on");$("#flighttime1").removeClass("sort_time_on");}else{$("#sortprice1").removeClass("sort_price_on");$("#flighttime1").addClass("sort_time_on");}}else{if(g=="aircorp"&&a==""){$("#sortprice2").addClass("sort_price_on");$("#flighttime2").removeClass("sort_time_on");}else{$("#sortprice2").removeClass("sort_price_on");$("#flighttime2").addClass("sort_time_on");}}RoundTripController.SearchRequest.OrderBy=h;if(f.endsWith("1")){var b=$.makeArray(this.DataList.find("div[method='DataRow1']"));this.selectSort(b,i);$(b).insertAfter($("#datalist2").find("ul").eq(0));}else{if(f.endsWith("2")){var c=$.makeArray(this.DataList.find("div[method='DataRow2']"));this.selectSort(c,i);$(c).insertAfter($("#datalist1").find("ul").eq(0));}}switch(f){case"airCorpFilter1":this.FilterFlightMethod(1,j,d.prev().val());break;case"airCorpFilter2":this.FilterFlightMethod(2,j,d.prev().val());break;case"timeFilter1":this.FilterFlightMethod(1,d.next().val(),j);break;case"timeFilter2":this.FilterFlightMethod(2,d.next().val(),j);break;case"selectsort1":this.FilterFlightMethod(1,d.next().next().val(),d.next().val());break;case"selectsort2":this.FilterFlightMethod(2,d.next().next().val(),d.next().val());break;default:break;}},SelectAirCorpOnChangeNew:function(d){var c=Event.element(d);var g=c.attr("name");var i=c.attr("value");var e=c.attr("id");var f=e[e.length-1];var h=new Array();$("span[method='view'][list="+f+"]").click();h.push(i.toLowerCase());if(i=="FlightTime"){h.push("price");}else{h.push("flighttime");}if(g=="goselectsort1"){if(i=="Price"){$("#sortprice1").addClass("sort_price_on");$("#flighttime1").removeClass("sort_time_on");}else{$("#sortprice1").removeClass("sort_price_on");$("#flighttime1").addClass("sort_time_on");}}else{if(i=="Price"){$("#sortprice2").addClass("sort_price_on");$("#flighttime2").removeClass("sort_time_on");}else{$("#sortprice2").removeClass("sort_price_on");$("#flighttime2").addClass("sort_time_on");}}RoundTripController.SearchRequest.OrderBy=i;if(g=="goselectsort1"){var a=$.makeArray(this.DataList.find("div[method='DataRow1']"));this.selectSort(a,h);$(a).insertAfter($("#datalist2").find("ul").eq(0));}else{if(g=="goselectsort2"){var b=$.makeArray(this.DataList.find("div[method='DataRow2']"));this.selectSort(b,h);$(b).insertAfter($("#datalist1").find("ul").eq(0));}}switch(g){case"airCorpFilter1":this.FilterFlightMethod(1,i,c.prev().val());break;case"airCorpFilter2":this.FilterFlightMethod(2,i,c.prev().val());break;case"timeFilter1":this.FilterFlightMethod(1,c.next().val(),i);break;case"timeFilter2":this.FilterFlightMethod(2,c.next().val(),i);break;case"gotimeselectsort1":case"gopriceselectsort1":this.FilterFlightMethod(1,c.next().next().val(),c.next().val());break;case"backtimeselectsort2":case"backpriceselectsort2":this.FilterFlightMethod(2,c.next().next().val(),c.next().val());break;default:break;}},selectSort:function(a,f){if(a.length>100){return a;}var h;for(var c=0;c<a.length;c++){var e=c;for(var d=c+1;d<a.length;d++){var g=false;if(g){break;}var b=this.itemComparer($(a[d]),$(a[e]),f,"asc");switch(b){case 1:h=a[d];a[d]=a[e];a[e]=h;g=true;break;case -1:g=true;break;}}}return a;},itemComparer:function(a,b,c,d){var f=false;var e=c[0];var g="";if(c.length>1){g=c[1];}switch(d){case"desc":f=parseInt(a.attr(e))>parseInt(b.attr(e));break;case"asc":f=parseInt(a.attr(e))<parseInt(b.attr(e));break;}if(f){return 1;}if(!f&&parseInt(a.attr(e))==parseInt(b.attr(e))){f=parseInt(a.attr(g))<parseInt(b.attr(g));if(f){return 1;}else{return 0;}}return -1;},FilterFlightMethod:function(c,a,b){if($("#choosed"+c).val()!=""){var d=this.DataList.find("p[method='msg'][list='"+c+"']");d.next().hide();d.hide();$("#placeOrder").hide();$("#choosed"+c).val("");}this.DataList.find("div[method='DataRow"+c+"']").each(function(){var e=$(this).find("input[type='hidden'][method='hdnFilter']");var f=$(this).find("input[type='hidden'][method='timeFilter']").val();$(this).find("input[type='radio']").attr("checked","");if($(this).find("span[method='spanMore']").hasClass("flight_down")){}if(a!=""&&b!=""){if(b==f&&(a.indexOf(e.attr("aircorp1"))>=0||(e.attr("aircorp2")!=""&&a.indexOf(e.attr("aircorp2"))>=0))){$(this).slideDown("slow");}else{$(this).slideUp("slow");}}else{if(a==""&&b!=""){if(b==f){$(this).slideDown("slow");}else{$(this).slideUp("slow");}}else{if(a!=""&&b==""){if(a.indexOf(e.attr("aircorp1"))>=0||(e.attr("aircorp2")!=""&&a.indexOf(e.attr("aircorp2"))>=0)){$(this).slideDown("slow");}else{$(this).slideUp("slow");}}else{$(this).slideDown("slow");}}}});FunctionExt.defer(function(){$("span[method='flightcount']").eq(c-1).html(this.DataList.find("div[method='DataRow"+c+"']:visible").length);if(this.DataList.find("div[method='DataRow"+c+"']:visible").length==0){if(c=="1"){$(".tishi").hide();}}else{$("p[method='NoResult']").eq(c-1).hide();$("p[method='NoResult']").eq(c-1).next().hide();}},1000,this);},ShowlowestPriceCalendarOnClick:function(b){var a=Event.element(b);var c=a.attr("method");if(c=="30calendarArrow"){a=a.parents("span").eq(0);}var d=a.children("i");if(d.attr("tag")=="down"){d.attr("tag","up");d.addClass("up");this.calendar.slideDown("slow");}else{d.attr("tag","down");d.removeClass("up");this.calendar.slideUp("slow");}if(a.attr("load")=="false"){$("img[method='imgWaitLeft']").attr("src",$("input[type='hidden'][method='hdnWait']").val());$("#searchwaitLeft").show();$("img[method='imgWaitRight']").attr("src",$("input[type='hidden'][method='hdnWait']").val());$("#searchwaitRight").show();FlightAjaxController.GetRoundTripCalendar(RoundTripController.SearchRequest,30,function(e){if(e.value.length>0){$("#belowbuttons").show();$("#searchwaitLeft").hide();var f=$("<div>"+e.value+"</div>").find("div[method='findtable']");$("#day30CalendarLeft").html(f[0]);this.calendar.find("#day30CalendarRight").html(f[1]);if($.browser.msie){if($.browser.version=="6.0"){this.calendar.find("dd").css("margin-left","-3px");}}a.attr("load","true");}else{a.attr("load","false");}}.bind(this));$("#calendar").bind("click",this.onRTLowestCalendarClick.bindAsEventListener(this));}},onRTLowestCalendarClick:function(d){var c=Event.element(d);if(c[0].nodeName=="INPUT"){if($(c).is(":hidden")){$(c).parents("td").removeClass("on");return;}this.onLowestPriceDateChange(d);return;}var f=$(c);if(c[0].nodeName!="DL"){f=f.parents("dl").find("a[method]");}else{f=f.find("a[method]");}if(f==null){return;}var e=f.attr("method");c=f;switch(e){case"getOWLowestPriceOneDay":var b=c.parent().prev().find("input").attr("value");c.hide();if(c.next().attr("class")!="s2_loading"){c.after("<span class=s2_loading></span>");}c.next().show();var a={request:RoundTripController.SearchRequest,beginDate:b,endDate:b};a=elongAjax.buildArgObject(Object.clone(a));jQuery.ajax({type:"GET",url:"/isajax/flightajax/GetOneWayLowestPrice",cache:false,data:a,success:function(g){if(g.success&&g.value.length>0&&g.value[0].Price>0){c.next().hide();c.parent().prev().find("input").attr("disabled",false).show();c.parent().prepend("&yen;"+g.value[0].Price);c.remove();}else{c.show();c.next().hide();}},complete:function(g){if(g&&g.readyState!=4){c.show();c.next().hide();return;}},error:function(h,g){c.show();c.next().hide();},dataType:"json",timeout:60000});default:return;}},onLowestPriceDateChange:function(b){var a=Event.element(b);var c=a.attr("method");var d=a.attr("name");var e=validator.reFormatDateString(a.attr("value"));a.parents("table").eq(0).find(".on").removeClass("on");a.parents("td").addClass("on");if(d=="1"){$("#LowestPriceStartDate").val(a.attr("value"));$("input[type='radio'][name='2']").each(function(){var f=validator.reFormatDateString($(this).attr("value"));if(f<=e){$(this).attr("disabled",true);$(this).parent().next().find("a").addClass("dis").attr("method","");}else{$(this).attr("disabled",false);$(this).parent().next().find("a").removeClass("dis").attr("method","getOWLowestPriceOneDay");}});}else{if(d=="2"){$("#LowestPriceEndDate").val(a.attr("value"));$("input[type='radio'][name='1']").each(function(){var f=validator.reFormatDateString($(this).attr("value"));if(f>=e){$(this).attr("disabled",true);$(this).parent().next().find("a").addClass("dis").attr("method","");}else{$(this).attr("disabled",false);$(this).parent().next().find("a").removeClass("dis").attr("method","getOWLowestPriceOneDay");}});}}},StopOver:function(b,a){var d=Object.clone(RoundTripController.SearchRequest);var c=a.parent().parent().find(".cols5").find("input");c.attr("name")=="list_2"?d.PageName="backlist":d.PageName="golist";FlightAjaxController.GetStopOverInfo(b,d,function(e){if(e.success){if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({htmlContent:"<div >"+e.value+"</div>",eventElement:a,defer:false,width:240});}}.bind(this));},GetEmergencyInfo:function(){FlightAjaxController.GetEmergencyInfo(RoundTripController.SearchRequest,function(a){if(a.success){if(!String.isNullOrEmpty(a.value)){$("#emergency").html(a.value);$("#emergency").slideDown("slow");}}});FlightAjaxController.GetSecondEmergencyInfo(RoundTripController.SearchRequest,function(a){if(a.success){if(!String.isNullOrEmpty(a.value)){$("#emergency2").html(a.value);$("#emergency2").slideDown("slow");}}});},ItemsClick:function(b){var a=Event.element(b);if(a.get(0).tagName.toLowerCase()!="li"){return;}this.selectCloseUsing=1;var e=a.parents("div.droplist");e.find("span.value").html(a.html());var d=e.attr("idtag");var c=$("#"+d);if(c.length>0){$("#"+d).val(a.attr("code")).trigger("change");}else{$("#"+d).val(a.attr("code"));}e.removeClass("droplist_on");this.selectUsingObj="";this.isItemHover=0;this.delayTime4Select=setTimeout(function(){this.selectCloseUsing=0;this.isClickSelectTextObj=0;}.bind(this),200);},changeTab:function(b){var a=Event.element(b);if(!a.attr("index")){a=a.parent();}var d=a.attr("index");$("#tabIndex").val(d);if(d==0){a.addClass("cur");a.next().removeClass("cur");this.DataList.show();this.ComposeList.hide();$("#placeOrder").hide();if($("#choosed1").val()!=""&&$("#choosed2").val()!=""){$("#placeOrder").show();}else{$("#placeOrder").hide();}}else{if(d==1){a.addClass("cur");a.prev().removeClass("cur");this.DataList.hide();this.ComposeList.show();var c=a.attr("loaded");if(c==0){a.attr("loaded",1);this.getRoundTripComposeList();}$("#placeOrder").hide();}}},getRoundTripComposeList:function(){RoundTripController.GetRoundTripComposeList(RoundTripController.SearchRequest,function(a){this.ComposeList.html(a.value);this.ComposeList.find("select[method = 'filter']").bind("change",this.onFilterByTimeChange.bindAsEventListener(this));}.bind(this),false,"POST");},onFilterByTimeChange:function(a){var b=Event.element(a);var f=b.attr("id");var h=b.attr("value");var g=b.attr("method");var d=$("#filterByDepartTime").val();var c=$("#filterByArriveTime").val();this.ComposeList.find("h2").each(function(){var i=$(this);var j=$(this).attr("goflag");var e=$(this).attr("backflag");if((d==0||d==j)&&(c==0||c==e)){i.show();}else{i.hide();}});this.ComposeList.find(".saleTableList").each(function(){var i=$(this);var j=$(this).attr("goflag");var e=$(this).attr("backflag");if((d==0||d==j)&&(c==0||c==e)){i.show();}else{i.hide();}});},render:function(){if(RoundTripController.SearchRequest.FlightType=="RoundTrip"){new CityWindow({eventElement:$("#Round_DepartCity"),cityType:"flightsrc",lang:RoundTripController.Language.toLowerCase(),resultNextId:"Round_ArriveCity",onSelect:function(b,a){$("#Round_DepartCity").attr("citythreesign",a.CityThreeSign);$("#Round_DepartCity").attr("citynameen",a.CityNameEn);$("#Round_ArriveCity").click();}});new CityWindow({eventElement:$("#Round_ArriveCity"),cityType:"flightsrc",lang:RoundTripController.Language.toLowerCase(),resultNextId:"DepartDate",onSelect:function(b,a){$("#Round_ArriveCity").attr("citythreesign",a.CityThreeSign);$("#Round_ArriveCity").attr("citynameen",a.CityNameEn);$("#DepartDate").click();}});}},destroyDOM:function(){this.btnBooking.removeClass("bt_ord com_book_dis").addClass("bt_ord").removeAttr("disabled");this.divSearch=null;this.DataList=null;this.calendar=null;this.day30=null;this.DateInput=null;this.btnsearchAgain=null;this.btnSearch=null;this.DateStyle=null;this.NowDate=null;this.NextDate=null;this.SelectAirCorp=null;this.SelectDepartTime=null;this.SortUl=null;this.SortUl2=null;this.btBooking=null;},destroyEvent:function(){},dispose:function(){this.destroyEvent();this.destroyDOM();}});var client=null;$(document).ready(function(){client=new ListResultClient();});